<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>GBG Programmer</title>

    <!-- lightly modified from https://github.com/dbuezas/arduino-web-uploader -->
    <script src="./arduino-web-uploader.js"></script>

    <script src="./script.js"></script> <!-- for the Upload Program section -->

</head>

<body style="background-color:lightgrey;">

    <main>
        <h1> <a target="_blank" rel="noopener noreferrer" href="https://github.com/gobabygocarswithjoysticks/index">GBG
                joystick car</a> programming and configuring website. </h1>
        <p> For any questions about how to use this website, please post <a target="_blank" rel="noopener noreferrer"
                href="https://github.com/gobabygocarswithjoysticks/programmer/discussions/categories/support"> here</a>
            or email <a href="mailto: gobabygocarswithjoysticks@gmail.com">gobabygocarswithjoysticks@gmail.com</a>.
        </p>
        <p>
            This website can only change the settings of cars with the new code that this site uploads, it won't work
            with the original go baby go code.
        </p>

        <noscript> <mark> Your browser is not running a script that is required for this website to function. Please
                enable javascript or try a different browser. </mark> </noscript>
        <mark id="serial-alert"> </mark>

        <div id="options-buttons">
            <br>
            <button id="config-button" onclick="showConfigButton()">I want to change the settings of my car.</button>
            <button id="first-time-program-button" onclick="showFirstTime()">I want to upload code to a new
                car.</button>
            <button id="everything-button" onclick="showEverythingButton()">Show me all the options at once.</button>
            <br>
            <br>
        </div>
        <hr>
        <div id="upload-program">
            <h2> Upload Program </h2>

            <mark id="no-config-alert"> </mark>
            <div id="upload-controls-div">
                <br>
                <label for="program-selector">Select program to upload:</label>
                <select name="program-selector" id="program-selector" onchange="updateBoardOptionsSelector();"></select>
                <br>
                <label for="board-selector">Select your board:</label>
                <select name="board-selector" id="board-selector" onchange="getCode();"></select>
                <br>
                <span id="upload-warning-span">
                </span>

                <button id="upload-button" arduino-uploader onclick="closeSerial()" board="" verify="true" hex-href="">
                    Upload! [<span class="upload-progress" id="upload-progress">Ready</span>]
                </button>


            </div>

            <p>
            <details>
                <summary>
                    Advanced settings
                </summary>
                <ol>
                    <li id="source-name-display">
                    </li>
                    <li>
                        Get car code from main branch instead of from most recent release:
                        <input type="checkbox" id="upload-main-checkbox" onclick="updateUpload()"></input>
                    </li>
                </ol>
                <p>The "nano" (not "nanoOldBootloader") option works for the Arduino Uno too.</p>
            </details>
            </p>

            <hr>
        </div>
        <div id="connect-to-car">
            <h2>Connect to Car (to change settings)</h2>
            <p id="serial-connected-indicator">After pressing connect, a box will pop up. Choose the car's serial
                port in the box that pops up (unplug and replug the car and whichever option goes away and comes back is
                the car).</p>
            <button id="serial-connect-button" onclick="connectToSerial()">connect</button>
            <button id="serial-disconnect-button" onclick="closeSerial()">disconnect</button>
            <hr>
        </div>
        <div id="configure-car">
            <h2>Calibrate and Configure Your Car</h2>
            <div id="cal-con-first-look-message">Connect to your car to see settings here.<br></div>
            <table>
                <tr style="text-align: center">
                    <td>
                        Joystick Input
                    </td>
                    <td>
                        Scaled Speed Target
                    </td>
                    <td>
                        Smoothed Speed to Drive
                    </td>
                    <td>
                        Motor Signals
                    </td>
                </tr>
                <tr>
                    <td>
                        <canvas id="joystick-input-canvas" width="220" height="220">
                            <div>Error displaying canvas! Try a different browser?</div>
                        </canvas>
                    </td>
                    <td>
                        <canvas id="scaled-input-canvas" width="220" height="220">
                            <div>Error displaying canvas! Try a different browser?</div>
                        </canvas>
                    </td>
                    <td>
                        <canvas id="smoothed-input-canvas" width="220" height="220">
                            <div>Error displaying canvas! Try a different browser?</div>
                        </canvas>
                    </td>
                    <td>
                        <canvas id="motor-signal-canvas" width="220" height="220">
                            <div>Error displaying canvas! Try a different browser?</div>
                        </canvas>
                    </td>
                </tr>
            </table>

            <button id="save-settings-button" style="font-size: 24px;" onclick='sendStringSerial("SAVE,")'>Save
                Changes</button>
            <span id="save-settings-button-label"></span>
            <br><br>

            <button id="show-pins-settings-button" onclick="showPinSettings()">choose pins</button>
            <button id="show-joystick-settings-button" onclick="showJoystickSettings()">calibrate joystick</button>
            <button id="show-drive-settings-button" onclick="showSpeedSettings()">change acceleration, speed, and other
                drive settings</button>
            <button id="show-all-settings-button" onclick="showAllSettings()">show all</button>
            <br>

            <p id="config-help-paragraph"></p>

            <table id="car-settings">
                <!-- settings received from the car will show up here -->
            </table>

            <br>
            <p>
            <details>
                <summary>
                    Advanced settings
                </summary>
                <button id="read-back-settings-button" onclick='sendStringSerial("SETTINGS,")'>read back
                    settings</button>
                <button id="revert-settings-button" onclick='sendStringSerial("REVERT,")'>revert to default</button>
                <button id="reboot-arduino-button"
                    onclick='sendStringSerial("REBOOT,");    document.getElementById("save-settings-button-label").innerHTML = "";'>reboot
                    arduino, revert to saved settings</button>
                <div id="settings-advanced-settings-info">no extra info loaded yet</div>
            </details>
            </p>
            <hr>
        </div>
        <br>
        <br>
        <footer style="text-align:center">
            The source code for this website is on Github <a target="_blank" rel="noopener noreferrer"
                href="https://github.com/gobabygocarswithjoysticks/programmer">here</a>.
            <br>

            <br>
            This website uses <a target="_blank" rel="noopener noreferrer"
                href="https://github.com/dbuezas/arduino-web-uploader">arduino-web-uploader</a>
            (generously shared under the MIT license)
            by David Buezas for uploading code to the car.
        </footer>


    </main>
</body>

</html>