<!DOCTYPE html>
<html lang="en" style="width:100wh;">

<head>
    <meta charset="UTF-8">
    <title>GBG Programmer</title>

    <!-- lightly modified from https://github.com/dbuezas/arduino-web-uploader -->
    <script src="./arduino-web-uploader.js"></script>

    <script src="./script.js"></script> <!-- for the Upload Program section -->

</head>

<body style="background-color:lightgrey; width:100wh; overflow-wrap: break-word; margin:0; border:0; padding:0;">

    <main>
        <div id="main" style="width:60%">
            <h2> <a target="_blank" rel="noopener noreferrer"
                    href="https://github.com/gobabygocarswithjoysticks/index">GBG
                    joystick car</a> programming and configuring website. </h2>
            <p> For any questions about how to use this website, please post <a target="_blank"
                    rel="noopener noreferrer"
                    href="https://github.com/gobabygocarswithjoysticks/programmer/discussions/categories/support">
                    here</a>
                or email <a href="mailto: gobabygocarswithjoysticks@gmail.com">gobabygocarswithjoysticks@gmail.com</a>.
            </p>
            <p>
                This website can only change the settings of cars with the new code that this site uploads, it won't
                work with the original go baby go code.
            </p>

            <noscript> <mark> Your browser is not running a script that is required for this website to function.
                    Please
                    enable javascript or try a different browser. </mark> </noscript>
            <mark class="serial-alert"> </mark>
            <div id="options-buttons">
                <br>
                <button id="first-time-program-button" onclick='
                        document.getElementById("hcbp-start").style.outline = "4px solid magenta";
                        showFirstTime();'>I want to upload code to a new car.
                </button>
                <br><br>
                <button id="config-button" onclick='document.getElementById("hcbs-plug").style.outline = "4px solid magenta";
                    showConfigButton();'>I want to change the settings of my car.
                </button>
                <br><br>
                <button id="everything-button" onclick="showEverythingButton()">Show me all the options at
                    once.</button>
                <br>
                <br>
            </div>
            <mark id="eepromFailureMessageSpace" hidden></mark>
            <hr>
            <div id="upload-program">
                <h2> Upload Program </h2>
                <mark id="no-config-alert"> </mark>
                <div id="upload-controls-div">
                    <div id="program-selector-container">
                        <label for="program-selector">Select program to upload:</label>
                        <select name="program-selector" id="program-selector"
                            onchange="updateBoardOptionsSelector();"></select>
                    </div>
                    <br>
                    <div id="board-selector-container">
                        <label for="board-selector">Select your board:</label>
                        <select name="board-selector" id="board-selector" onchange="getCode();"></select>
                    </div>
                    <br>
                    <span id="upload-warning-span">
                    </span>
                    <button id="upload-button" arduino-uploader onclick="closeSerial()" board="" verify="true"
                        hex-href="">
                        Upload! [<span class="upload-progress" id="upload-progress">Ready</span>]
                    </button>
                    <span class="upload-info"></span>
                </div>
                <p>
                <details>
                    <summary>
                        Advanced settings
                    </summary>
                    <ol>
                        <li>These options are only useful to people developing code for these cars.</li>
                        <li id="source-name-display">
                        </li>
                        <li>
                            Get car code from main branch instead of from most recent release:
                            <input type="checkbox" id="upload-main-checkbox" onclick="updateUpload()"></input>
                        </li>
                    </ol>
                </details>
                </p>

                <hr>
            </div>
            <div id="connect-to-car">
                <h2>Connect to Car (to change settings)</h2>
                <button id="serial-connect-button" onclick='document.getElementById("serial-connect-button").style.border = "";
                connectToSerial();'>connect</button>
                <button id="serial-disconnect-button"
                    onclick='document.getElementById("serial-disconnect-button").style.border=""; closeSerial();'>disconnect</button>
                <hr>
            </div>
            <div id="configure-car">
                <h2>Calibrate and Configure Your Car</h2>
                <div id="joystick-not-centered-message" hidden><mark>The joystick doesn't appear to be centered.
                        <br>
                        Please center the joystick, and if this message doesn't go away, please calibrate the joystick.
                        <br> As a safety measure, the car won't drive until the joystick is centered.</mark><br></div>
                <div id="cal-con-first-look-message">Connect to your car to see settings here.<br><br></div>
                <table>
                    <tr style="text-align: center">
                        <td>

                        </td>
                        <td>
                            Joystick Input
                        </td>
                        <td>
                            Scaled Speed Target
                        </td>
                        <td>
                            Smoothed Speed to Drive
                        </td>
                        <td>
                            Motor Signals<br>
                            motors: <b><span class="liveVal-movementAllowed">status loading</span></b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            test settings without the car moving
                            <br><br>
                            motors: <b><span class="liveVal-movementAllowed">status loading</span></b>
                            <br><br>
                            <button id="motors-on-off-button"></button>
                        </td>
                        <td>
                            <canvas id="joystick-input-canvas" width="220" height="220">
                                <div>Error displaying canvas! Try a different browser?</div>
                            </canvas>
                        </td>
                        <td>
                            <canvas id="scaled-input-canvas" width="220" height="220">
                                <div>Error displaying canvas! Try a different browser?</div>
                            </canvas>
                        </td>
                        <td>
                            <canvas id="smoothed-input-canvas" width="220" height="220">
                                <div>Error displaying canvas! Try a different browser?</div>
                            </canvas>
                        </td>
                        <td>
                            <canvas id="motor-signal-canvas" width="220" height="220">
                                <div>Error displaying canvas! Try a different browser?</div>
                            </canvas>
                        </td>
                    </tr>
                </table>

                <button id="save-settings-button" style="font-size: 24px;" onclick='sendStringSerial("SAVE,")'>Save
                    Changes</button>
                <span id="save-settings-button-label"></span>
                <br><br>

                <button id="show-pins-settings-button" onclick="showPinSettings()">choose pins</button>
                <button id="show-joystick-settings-button" onclick="showJoystickSettings()">calibrate
                    joystick</button>
                <button id="show-drive-settings-button" onclick="showSpeedSettings()">change acceleration, speed,
                    and other drive settings</button>
                <button id="show-all-settings-button" onclick="showAllSettings(true)">show all</button>
                <br>

                <p id="config-help-paragraph"></p>

                <table id="car-settings">
                    <!-- settings received from the car will show up here -->
                </table>

                <br>
                <span id="save-settings-button-label-2"></span>
                <p>
                <details>
                    <summary>
                        Advanced settings
                    </summary>
                    <button id="read-back-settings-button" onclick='sendStringSerial("SETTINGS,")'>read back
                        settings in RAM</button>
                    <button id="revert-settings-button" onclick='sendStringSerial("REVERT,")'>revert to
                        default</button>
                    <button id="reboot-arduino-button"
                        onclick='sendStringSerial("REBOOT,");  document.getElementById("save-settings-button-label").innerHTML = ""; document.getElementById("save-settings-button-label-2").innerHTML = "";'>reboot
                        arduino, revert to saved settings</button>
                    <div id="settings-advanced-settings-info">no extra info loaded yet</div>
                </details>
                </p>
                <hr>
            </div>
            <br>
            <br>
            <footer style="text-align:center">
                The source code for this website is on Github <a target="_blank" rel="noopener noreferrer"
                    href="https://github.com/gobabygocarswithjoysticks/programmer">here</a>.
                <br>

                <br>
                This website uses <a target="_blank" rel="noopener noreferrer"
                    href="https://github.com/dbuezas/arduino-web-uploader">arduino-web-uploader</a>
                (generously shared under the MIT license)
                by David Buezas for uploading code to the car.
            </footer>
        </div> <!-- // end of main div -->
        <div id="help-header"
            style="width:40%; height:10vh; position:fixed; right:0; top:0vh; background-color:grey; padding-left:1%; padding-right:1%; box-sizing:border-box;">
            <button onclick='document.getElementById("help-index").scrollIntoView();'>
                to top</button>
            <button
                onclick='document.getElementById("help").hidden=true; document.getElementById("help-header").hidden=true; document.getElementById("help-open").hidden=false; document.getElementById("main").style.width="100%"'
                style="float: right;">
                close help
            </button>
        </div>

        <div id="help-open" style="position: fixed; right:0; top:0vh;" hidden="true">
            <button
                onclick='document.getElementById("help").hidden=false; document.getElementById("help-header").hidden=false; document.getElementById("help-open").hidden=true; document.getElementById("main").style.width="60%"'>
                <h2>?</h2>
            </button>
        </div>







        <div id="help" style="width:40%; height:90vh; position:fixed; right:0; top:10vh; background-color:whitesmoke;
             overflow-y:auto; padding-left:1%; padding-right:1%; box-sizing:border-box">
            <p id="help-index">
                index
            </p>
            <div id="help-upload-container">
                <style>
                    li {
                        margin-top: 5px;
                    }
                </style>
                <hr>
                <h3 id="help-upload">
                    Programming the Car
                </h3>
                <mark class="serial-alert"> </mark>
                <ol>
                    <li>
                        <label for="hcbp-start">
                            Congratulations on finishing the
                            <a target="_blank" rel="noopener noreferrer"
                                href="https://github.com/gobabygocarswithjoysticks/index">
                                hardware modifications</a>
                            of your car!
                            <br><br>
                            <b>
                                Please check the box below every step (or click the text in the step) as you complete it
                                so that the website can you guide you through the process of programming the Arduino in
                                your car.
                            </b>
                            <br>
                        </label>
                        <input type="checkbox" class="help-checkbox" id="hcbp-start"
                            onchange='cbdone("hcbp-start","hcbp-plug");' />
                    </li>
                    <li>
                        <label for="hcbp-plug">Ensure the car is turned off (all lights in the car should be off), then
                            plug the Arduino into to your computer with a usb cable.
                            <details>
                                <summary>
                                    show me how
                                </summary>
                                <table>
                                    <tr>
                                        <td>
                                            <img src="./pics/power-off.JPG" alt="power switch turned off">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <img src="./pics/usb-align.JPG" alt="align the usb cable with the Arduino">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <img src="./pics/usb-plug.JPG" alt="plug the usb cable into the Arduino">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <img src="./pics/usb-computer-plug.jpg"
                                                alt="plug the usb cable into your computer">
                                        </td>
                                    </tr>
                                </table>
                            </details>
                            If you smell or see smoke when you plug the car in, unplug it immediately and check for
                            short circuits in your car's wiring.
                        </label>
                        <br>
                        <input type="checkbox" class="help-checkbox" id="hcbp-plug"
                            onchange='showFirstTime(); cbdone("hcbp-plug","hcbp-upload");
                                 document.getElementById("program-selector-container").style.outline = "2px solid LimeGreen";
                                 document.getElementById("hcbp-default-selection-text").style.outline = "2px solid LimeGreen";
                                 document.getElementById("board-selector-container").style.outline = "2px solid SlateBlue";
                                 document.getElementById("hcbp-board-selection-text").style.outline = "2px solid SlateBlue";' disabled />
                    </li>
                    <li>
                        <label for="hcbp-upload">
                            <span id="hcbp-default-selection-text">
                                The selector for what program to upload should be left on "gbg_program".
                            </span><br><br>
                            <span id="hcbp-board-selection-text">
                                The selector for what type of Arduino board is in your car can be left on
                                "nanoOldBootloader" if you have a less expensive Arduino Nano clone, or should be
                                changed to say "nano" if you bought an official Arduino Nano or Uno board.
                            </span>
                            <br>
                            <br>
                            When you click the checkbox below, a box will pop up, which you will use in the next step.
                            <br>
                        </label>
                        <input type="checkbox" class="help-checkbox" id="hcbp-upload" disabled onchange='cbdone("hcbp-upload"); cbhighlight("hcbp-uploading"); 
                        document.getElementById("upload-button").click();
                        document.getElementById("hcbp-uploading").scrollIntoView({ block: "end" });
                        document.getElementById("program-selector-container").style.outline = "0px";
                        document.getElementById("hcbp-default-selection-text").style.outline = "0px";
                        document.getElementById("board-selector-container").style.outline = "0px";
                        document.getElementById("hcbp-board-selection-text").style.outline = "0px";' disabled />
                    </li>
                    <li>
                        <label for="hcbp-uploading">
                            In the box that popped up, click on the car's serial port in the list (to find the car's
                            port you can unplug and replug the USB cable and whichever option goes away and comes
                            back is the car). Then, click the "connect" button of the box.
                            <br><br>
                            If there is an error with uploading, you might need to follow instructions that will
                            appear below this paragraph to select the car's port again and try uploading again.
                            <br><br>
                            <div id="upload-connect-comment"></div>
                            <div class="upload-info" id="hcbp-upload-info"></div>
                        </label>
                        <input type="checkbox" class="help-checkbox" id="hcbp-uploading" disabled />
                    </li>
                    <li>
                        <label for="hcbp-upload-done">
                            The code has now been uploaded, but that process causes the car to disconnect. So, the next
                            step is to connect to the car again in order to customize its settings. You will
                            need to select the car's port for a second time, just like in the step above. Check the box
                            below to continue.
                        </label>
                        <br> <input type="checkbox" class="help-checkbox" id="hcbp-upload-done" disabled onchange='cblightoff("hcbs-plug"); cbdis("hcbs-plug"); cbchk("hcbs-plug"); cbdone("hcbp-upload-done","hcbs-connect"); document.getElementById("hcbs-connect").scrollIntoView({ block: "end" });
                            connectToSerial()' />
                    </li>
                </ol>
                <hr>
                <h3 id="help-settings">
                    Settings
                </h3>
                <mark class="serial-alert"> </mark>

                <ol>
                    <li>
                        <label for="hcbs-plug">Ensure the car is turned off (all lights in the car should be off),
                            then connect the Arduino to your computer with a usb cable.
                            <br>
                            <b>Please check the box below every step (or click the text in the step) as you complete it
                                so that the website can you guide you through the process of programming the Arduino in
                                your car.</b>
                            <details>
                                <summary>
                                    show me how
                                </summary>
                                <table>
                                    <tr>
                                        <td>
                                            <img src="./pics/power-off.JPG" alt="power switch turned off">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <img src="./pics/usb-align.JPG" alt="align the usb cable with the Arduino">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <img src="./pics/usb-plug.JPG" alt="plug the usb cable into the Arduino">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <img src="./pics/usb-computer-plug.jpg"
                                                alt="plug the usb cable into your computer">
                                        </td>
                                    </tr>
                                </table>
                            </details>

                            If you smell or see smoke when you plug the car in, unplug it immediately and check for
                            short circuits in your car's wiring.
                            <br>
                            Please check the box below to each step and the website will you guide you through
                            the process of using this website to change the settings of car.
                            <br> The next step will help you connect to your car. A box will pop up.
                        </label>
                        <br>
                        <input type="checkbox" class="help-checkbox" id="hcbs-plug" onclick='showConfigButton(); cbdone("hcbs-plug"); cbhighlight("hcbs-connect"); 
                            document.getElementById("hcbs-connect").scrollIntoView({ block: "end" });
                            connectToSerial();' />
                    </li>

                    <li>
                        <label for="hcbs-connect">
                            In the box that popped up, choose the
                            car's serial port (if you don't know which port is your car, you can unplug and replug the
                            USB cable and whichever
                            option goes away and comes back is the car).
                            <p id="serial-connected-indicator">
                            </p>
                        </label>
                        <input type="checkbox" class="help-checkbox" id="hcbs-connect" disabled />
                    </li>

                    <li>
                        <label for="hcbs-setting-index">
                            setting index
                        </label>
                        <br>
                        <input type="checkbox" class="help-checkbox" id="hcbs-setting-index" disabled />
                    </li>


                </ol>
            </div>
        </div> <!-- end of help div -->
    </main>
</body>

</html>